class <%= data_migration_name %> < ActiveRecord::Migration

  class <%= custom_field_class_name %> < ActiveRecord::Base
    serialize :select_options
    has_many :<%= select_options_table_name %>
  end
  class <%= custom_field_select_options_class_name %> < ActiveRecord::Base
    belongs_to :<%= custom_field_relationship_name %>
  end
  
  def self.up
    # extract the existing data out of <%= field_table_name %>.select_options and into the new table
    <%= custom_field_class_name %>.all.each do |custom_field|
      custom_field.select_options.to_a.each do |option|
        <%= custom_field_select_options_class_name %>.create!(:<%= name.underscore %>_field_id => custom_field.id, :option => option)
      end
    end
  end

  def self.down
    # get the data out of <%= select_options_table_name %> and put it back into the <%= field_table_name %>.select_options attribute
    <%= custom_field_class_name %>.all.each do |custom_field|
      custom_field.update_attributes!(:select_options => custom_field.<%= select_options_table_name %>.map(&:option))
    end
  end
end