class <%= migration_class_name %> < ActiveRecord::Migration
  def self.up
    create_table(:<%= field_table_name %>) do |t|
      t.string :name, :null => false, :limit => 63
      t.string :style, :null => false, :limit => 15
      t.string :select_options
      <%- scope_foreign_keys.each do |scoped_foreign_key| -%>
      t.integer :<%= scoped_foreign_key %>
      <%- end -%>
      t.timestamps
    end
    add_index :<%= field_table_name %>, <%= (scope_foreign_keys + ['name']).inspect %>, :unique => true
    
    create_table(:<%= attributes_table_name %>) do |t|
      t.integer :<%= model_foreign_key %>, :null => false
      t.integer :<%= field_table_name.singularize.foreign_key %>, :null => false
      t.string  :value, :null => false
      t.timestamps
    end
    
    add_index :<%= attributes_table_name %>, <%= [model_foreign_key, field_table_name.singularize.foreign_key].inspect %>, :unique => true
    add_index :<%= attributes_table_name %>, :<%= model_foreign_key %>
    add_index :<%= attributes_table_name %>, :<%= field_table_name.singularize.foreign_key %>
    add_index :<%= attributes_table_name %>, :value
  end

  def self.down
    drop_table(:<%= field_table_name %>)
    drop_table(:<%= attributes_table_name %>)
  end
end
